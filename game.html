<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Canvas tutorial</title>
    <script type="text/javascript">
        
      const state = {
          PLAYING: "playing",
          REDWINS: "redwins",
          YELLOWWINS: "yellowwins",
          DRAW: "draw"
      } 
      
      var gameState = state.PLAYING;
          
      
      var boardImage = new Image();
      boardImage.src = "Assets/c4Board.png";
      var player1Image = new Image();
      player1Image.src = "Assets/player1.png";
      var player2Image = new Image();
      player2Image.src = "Assets/player2.png";
      var redWinsImage = new Image();
      redWinsImage.src = "Assets/redWins.png";
      var yellowWinsImage = new Image();
      yellowWinsImage.src = "Assets/yellowWins.png";
      var playAgainImage = new Image();
      playAgainImage.src = "Assets/playAgain.png";    
        
      var player1Offset = [14, 9];
      var player2Offset = [14, 9];
         
      var player = 1;
      var boardArr = new Array(7);
      for ( let i = 0; i < 7; i++ ) {
          boardArr[i] = new Array(6);
          boardArr[i].fill(0);
      }
      
      boardArr[0][3] = 1;
      boardArr[4][5] = 2;
        
      function getMousePosition(canvas, event) {
          let rect = canvas.getBoundingClientRect();
          let x = event.clientX - rect.left;
          let y = event.clientY - rect.top;
          console.log("Coordinate x: " + x,
                      "Coordinate y: " + y);
          
          if ( gameState == state.PLAYING) {
              let col = parseInt(x / 100);
              console.log(col);
              placePiece(col);
              }
          
          else {
              if (x >= 200 && x <=532 && y >= 350 && y<= 449) {
                  gameState = state.PLAYING;
                  for ( let i = 0; i < 7; i++) {
                      boardArr[i].fill(0);
                      draw();
                  }
              }
          }
      }

        
      function checkWin(col, row, player) {
          // check vertical
          
          let rowToCheck = row;
          let count = 1;
          while (rowToCheck > 0) {
              rowToCheck--;
              if( boardArr[col][rowToCheck] == player) {
                  count++;
              }
              else {
                  break;
              }
          }
          
          rowToCheck = row;
          while (rowToCheck < 5) {
              rowToCheck++;
              if( boardArr[col][rowToCheck] == player) {
                  count++;
              }
              else {
                  break;
              }
          }

          if ( count >= 4) {
              gameState = player == 1 ? state.YELLOWWINS : state.REDWINS;
              console.log("game over");
              
          }      
        }
          
      
          
     
      function placePiece(col) {
          for (let row = 5; row >= 0; row--) {
              if (boardArr[col][row] == 0) {
                  if (player == 1) {
                      boardArr[col][row] = 1;
                      checkWin(col, row, player);
                      player = 2;
                  }
                  else {
                      boardArr[col][row] = 2;
                      checkWin(col, row, player);
                      player = 1;
                  }
                  break;
              }
        }
        draw()
    }
    
      
        
      function draw() {
        var canvas = document.getElementById('tutorial');
            if (canvas.getContext) {
              var ctx = canvas.getContext('2d');    
              ctx.drawImage(boardImage, 0,0);
              for (let row = 0; row < 6; row++) {
                  for (let col = 0; col < 7; col++) {
                      if (boardArr[col][row] == 0) {
                          //ctx.strokeRect( col * 100, row * 100, 100, 100);
                      }
                      else if ( boardArr[col][row] == 1) {
                          ctx.drawImage(player1Image, col * 100 + player1Offset[0], row * 100 + player1Offset[1]);
                      }
                      else if ( boardArr[col][row] == 2) {
                          ctx.drawImage(player2Image, col * 100 + player2Offset[0], row * 100 + player2Offset[1]);
                          
                      }
                  }
               }
                for (let row = 0; row < 6; row++) {
                    for (let col = 0; col < 7; col++) {
                        //ctx.strokeRect(col * 100, row * 100, 100, 100);
                    }
                }
                
                if (gameState == state.REDWINS) {
                    ctx.drawImage(redWinsImage, 200, 200);
                    ctx.drawImage(playAgainImage, 200, 350);
                }
                else if (gameState == state.YELLOWWINS) {
                    ctx.drawImage(yellowWinsImage, 200, 200);
                    ctx.drawImage(playAgainImage, 200, 350);
                }

             }
         }
        
      window.onload = function() {
         draw();
         let canvasElem = document.getElementById('tutorial');
          
          canvasElem.addEventListener("mousedown", function(evt)
          {
              getMousePosition(canvasElem,evt);
          });
      }    
    </script>
    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
  </head>
  <body>
    <canvas id="tutorial" width="726" height="625"></canvas>
  </body>
</html>
